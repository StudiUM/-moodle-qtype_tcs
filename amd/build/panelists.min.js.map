{"version":3,"sources":["../src/panelists.js"],"names":["define","$","Str","ModalFactory","ModalEvents","Templates","Notification","Ajax","SELECTORS","SENDACTIONBUTTON","PANELISTSSELECTEDCHECKBOXES","PANELISTSCHECKBOXES","CHECKALLLINK","CHECKNONELINK","Panelists","options","cmid","attachEventListeners","prototype","modal","on","e","preventDefault","ids","each","index","ele","id","val","push","showSendEmail","fail","exception","bind","prop","length","users","Deferred","resolve","promise","titlePromise","get_string","loadingtxtPromise","when","create","type","types","SAVE_CANCEL","body","render","then","title","loadingtxt","setTitle","setSaveButtonText","getRoot","hidden","focus","remove","save","submitSendEmail","self","messageText","find","subject","trim","show","append","css","call","methodname","args","message","displaynotification","result","window","location","reload","catch"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Send emails for panelist page.\n *\n * @module     mod_concordance/panelists\n * @package    mod_concordance\n * @copyright  2020 Université de Montréal\n * @author     Issam Taboubi <issam.taboubi@umontreal.ca>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/str', 'core/modal_factory', 'core/modal_events', 'core/templates', 'core/notification', 'core/ajax'],\n    function($, Str, ModalFactory, ModalEvents, Templates, Notification, Ajax) {\n\n        var SELECTORS = {\n            SENDACTIONBUTTON: \"#showpanelistemailpopup\",\n            PANELISTSSELECTEDCHECKBOXES: \"input[name='panelists']:checked\",\n            PANELISTSCHECKBOXES: \"input[name='panelists']\",\n            CHECKALLLINK: \"#checkall\",\n            CHECKNONELINK: \"#checknone\"\n        };\n\n        /**\n         * Constructor\n         *\n         * @param {Object} options Object containing options.\n         */\n        var Panelists = function(options) {\n\n            this.cmid = options.cmid;\n\n            this.attachEventListeners();\n        };\n\n        // Class variables and functions.\n\n        /**\n         * @var {Modal} modal\n         * @private\n         */\n        Panelists.prototype.modal = null;\n\n        /**\n         * @var {int} Course module id\n         * @private\n         */\n        Panelists.prototype.cmid = -1;\n\n        /**\n         * Private method\n         *\n         * @method attachEventListeners\n         * @private\n         */\n        Panelists.prototype.attachEventListeners = function() {\n            $(SELECTORS.SENDACTIONBUTTON).on('click', function(e) {\n                e.preventDefault();\n\n                var ids = [];\n                $(SELECTORS.PANELISTSSELECTEDCHECKBOXES).each(function(index, ele) {\n                    var id = $(ele).val();\n                    ids.push(id);\n                });\n\n                this.showSendEmail(ids).fail(Notification.exception);\n            }.bind(this));\n\n            $(SELECTORS.CHECKALLLINK).on('click', function(e) {\n                e.preventDefault();\n                $(SELECTORS.PANELISTSCHECKBOXES).prop('checked', true);\n                $(SELECTORS.SENDACTIONBUTTON).prop('disabled', false);\n            });\n\n            $(SELECTORS.CHECKNONELINK).on('click', function(e) {\n                e.preventDefault();\n                $(SELECTORS.PANELISTSCHECKBOXES).prop('checked', false);\n                $(SELECTORS.SENDACTIONBUTTON).prop('disabled', true);\n            });\n\n            $(SELECTORS.PANELISTSCHECKBOXES).on('change', function() {\n                // Enable/disable buttonsend.\n                if ($(SELECTORS.PANELISTSSELECTEDCHECKBOXES).length > 0) {\n                    $(SELECTORS.SENDACTIONBUTTON).prop('disabled', false);\n                } else {\n                    $(SELECTORS.SENDACTIONBUTTON).prop('disabled', true);\n                }\n            });\n        };\n\n        /**\n         * Show the send email popup.\n         *\n         * @method showSendEmail\n         * @private\n         * @param {int[]} users\n         * @return {Promise}\n         */\n        Panelists.prototype.showSendEmail = function(users) {\n\n            if (users.length == 0) {\n                // Nothing to do.\n                return $.Deferred().resolve().promise();\n            }\n            var titlePromise = null;\n            if (users.length == 1) {\n                titlePromise = Str.get_string('sendbulkmessagesingle', 'core_message');\n            } else {\n                titlePromise = Str.get_string('sendbulkmessage', 'core_message', users.length);\n            }\n            var loadingtxtPromise = Str.get_string('loading');\n            return $.when(\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        body: Templates.render('mod_concordance/send_bulk_email', {})\n                    }),\n                    titlePromise,\n                    loadingtxtPromise\n                    ).then(function(modal, title, loadingtxt) {\n                        // Keep a reference to the modal.\n                        this.modal = modal;\n\n                        this.modal.setTitle(title);\n                        this.modal.setSaveButtonText(title);\n\n                        this.modal.getRoot().on(ModalEvents.hidden, function() {\n                            $(SELECTORS.SENDACTIONBUTTON).focus();\n                            this.modal.getRoot().remove();\n                        }.bind(this));\n\n                        this.modal.getRoot().on(ModalEvents.save, this.submitSendEmail.bind(this, users, loadingtxt));\n                        var self = this;\n                        this.modal.getRoot().on('change keyup', '#subject-bulk-email, #body-bulk-email', function() {\n                            var messageText = self.modal.getRoot().find('form textarea').val();\n                            var subject = self.modal.getRoot().find('form input').val();\n                            messageText = messageText.trim();\n                            subject = subject.trim(subject);\n                            if (messageText.length === 0 || subject.length === 0) {\n                                self.modal.getRoot().find('button[data-action=\"save\"]').prop('disabled', true);\n                            } else {\n                                self.modal.getRoot().find('button[data-action=\"save\"]').prop('disabled', false);\n                            }\n                        });\n\n                        this.modal.show();\n\n                        return this.modal;\n                    }.bind(this));\n        };\n\n        /**\n         * Send a message to these users.\n         *\n         * @method submitSendEmail\n         * @private\n         * @param {int[]} users\n         * @param {String} loadingtxt\n         * @param {Event} e Form submission event.\n         * @return {Promise}\n         */\n        Panelists.prototype.submitSendEmail = function(users, loadingtxt, e) {\n            e.preventDefault();\n            var messageText = this.modal.getRoot().find('form textarea').val();\n            var subject = this.modal.getRoot().find('form input').val();\n            var loading = '<i class=\"fa fa-spinner fa-pulse m-l-1\"></i><span class=\"sr-only\">' + loadingtxt + '</span>';\n            this.modal.getRoot().find('button[data-action=\"save\"]').append(loading);\n            this.modal.getRoot().find('.modal-content').css('pointer-events', 'none');\n            return Ajax.call([{\n                methodname: 'mod_concordance_send_message',\n                args: {\n                    users: users,\n                    message: messageText,\n                    subject: subject,\n                    cmid: this.cmid,\n                    displaynotification: true\n                }\n                }])[0].then(function(result) {\n                    if (result) {\n                        window.location.reload(true);\n                    }\n                    return true;\n                }).catch(Notification.exception);\n        };\n\n        return /** @alias module:mod_concordance/panelists */ {\n            // Public variables and functions.\n\n            /**\n             * Initialise.\n             *\n             * @method init\n             * @param {Object} options - List of options.\n             * @return {Panelists}\n             */\n            'init': function(options) {\n                return new Panelists(options);\n            }\n        };\n    });\n"],"file":"panelists.min.js"}