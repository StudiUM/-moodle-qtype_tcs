define ("mod_concordance/panelists",["jquery","core/str","core/modal_factory","core/modal_events","core/templates","core/notification","core/ajax"],function(a,b,c,d,e,f,g){var h={SENDACTIONBUTTON:"#showpanelistemailpopup",PANELISTSSELECTEDCHECKBOXES:"input[name='panelists']:checked",PANELISTSCHECKBOXES:"input[name='panelists']",CHECKALLLINK:"#checkall",CHECKNONELINK:"#checknone"},i=function(a){this.cmid=a.cmid;this.attachEventListeners()};i.prototype.modal=null;i.prototype.cmid=-1;i.prototype.attachEventListeners=function(){a(h.SENDACTIONBUTTON).on("click",function(b){b.preventDefault();var c=[];a(h.PANELISTSSELECTEDCHECKBOXES).each(function(b,d){var e=a(d).val();c.push(e)});this.showSendEmail(c).fail(f.exception)}.bind(this));a(h.CHECKALLLINK).on("click",function(b){b.preventDefault();a(h.PANELISTSCHECKBOXES).prop("checked",!0);a(h.SENDACTIONBUTTON).prop("disabled",!1)});a(h.CHECKNONELINK).on("click",function(b){b.preventDefault();a(h.PANELISTSCHECKBOXES).prop("checked",!1);a(h.SENDACTIONBUTTON).prop("disabled",!0)});a(h.PANELISTSCHECKBOXES).on("change",function(){if(0<a(h.PANELISTSSELECTEDCHECKBOXES).length){a(h.SENDACTIONBUTTON).prop("disabled",!1)}else{a(h.SENDACTIONBUTTON).prop("disabled",!0)}})};i.prototype.showSendEmail=function(f){if(0==f.length){return a.Deferred().resolve().promise()}var g=null;if(1==f.length){g=b.get_string("sendbulkmessagesingle","core_message")}else{g=b.get_string("sendbulkmessage","core_message",f.length)}var i=b.get_string("loading");return a.when(c.create({type:c.types.SAVE_CANCEL,body:e.render("mod_concordance/send_bulk_email",{})}),g,i).then(function(b,c,e){this.modal=b;this.modal.setTitle(c);this.modal.setSaveButtonText(c);this.modal.getRoot().on(d.hidden,function(){a(h.SENDACTIONBUTTON).focus();this.modal.getRoot().remove()}.bind(this));this.modal.getRoot().on(d.save,this.submitSendEmail.bind(this,f,e));var g=this;this.modal.getRoot().on("change keyup","#subject-bulk-email, #body-bulk-email",function(){var a=g.modal.getRoot().find("form textarea").val(),b=g.modal.getRoot().find("form input").val();a=a.trim();b=b.trim(b);if(0===a.length||0===b.length){g.modal.getRoot().find("button[data-action=\"save\"]").prop("disabled",!0)}else{g.modal.getRoot().find("button[data-action=\"save\"]").prop("disabled",!1)}});this.modal.show();return this.modal}.bind(this))};i.prototype.submitSendEmail=function(a,b,c){c.preventDefault();var d=this.modal.getRoot().find("form textarea").val(),e=this.modal.getRoot().find("form input").val();this.modal.getRoot().find("button[data-action=\"save\"]").append("<i class=\"fa fa-spinner fa-pulse m-l-1\"></i><span class=\"sr-only\">"+b+"</span>");this.modal.getRoot().find(".modal-content").css("pointer-events","none");return g.call([{methodname:"mod_concordance_send_message",args:{users:a,message:d,subject:e,cmid:this.cmid,displaynotification:!0}}])[0].then(function(a){if(a){window.location.reload(!0)}return!0}).catch(f.exception)};return{init:function init(a){return new i(a)}}});
//# sourceMappingURL=panelists.min.js.map
